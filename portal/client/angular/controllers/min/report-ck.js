var app=angular.module("qa-portal"),Util=require("../util/util");app.controller("ReportsCtrl",function(e,o,n,t,r,s,l,i){function a(e,o){for(var n=0;n<e.length;n++)if(e[n].pk_component==o)return e[n]}e.selectedComponent={},e.selectedComponentR2={},e.selectedVersions={},e.util=new Util,t.query({all:!0},function p(o){e.components=o,e.availableComponentsR1=angular.copy(e.components),e.selectedComponentsR1=[],e.availableComponentsR2=angular.copy(e.components)}),e.version=[],s.query(function c(o){e.versions=o,e.availableVersionsR2=[],e.selectedCombinationsR2=[]}),e.showR1=!0,e.showR1Results=!1,e.showR2=!1,e.showR2Results=!1,e.reportR1=[],e.reportR2=[],e.exportReport=function(o){"r1"==o?e.filter_r1&&n.open("/api/v2/report_test_plans?export=true&filter="+e.filter_r1):e.filter_r2&&n.open("/api/v1/report_versions?export=true&filter="+e.filter_r2)},e.switchReport=function(o){e.showR1=!1,e.showR2=!1,"r1"==o&&(e.showR1=!0),"r2"==o&&(e.showR2=!0)},e.getReport=function(o){"r1"==o?(e.showR1Results=!0,e.filter_r1=e.util.join_by("pk_component",e.selectedComponentsR1),l.query({filter:e.filter_r1},function n(o){e.reportR1=[],angular.forEach(o,function(o){var n=a(e.reportR1,o.pk_component)||{name:o.name,pk_component:o.pk_component,test_plans:[]};-1==e.reportR1.indexOf(n)&&e.reportR1.push(n);var t=e.reportR1.indexOf(n);r.get({testPlanId:o.pk_test_plan},function s(o){e.reportR1[t].test_plans.push(o)})})},function t(){e.reportR1=[]})):"r2"==o&&(e.showR2Results=!0,console.log(e.selectedCombinationsR2),e.filter_r2=e.util.join_by("pk_version",e.selectedCombinationsR2),i.query({filter:e.filter_r2},function s(o){e.reportR2=o,console.log(o)},function p(){e.reportR2=[]}))},e.moveSelectedComponentsR1=function(o){for(var n=0;n<e.selectedComponent.length;n++)if("selected"==o){var t=e.availableComponentsR1.indexOf(e.selectedComponent[n]);-1!=t&&(e.selectedComponentsR1.push(e.selectedComponent[n]),e.availableComponentsR1.splice(t,1))}else if("available"===o){var r=e.selectedComponentsR1.indexOf(e.selectedComponent[n]);-1!=r&&(e.availableComponentsR1.push(e.selectedComponent[n]),e.selectedComponentsR1.splice(r,1))}},e.generateAvailableVersionsR2=function(){e.availableVersionsR2=[];var o=e.selectedComponentR2[0];angular.forEach(e.versions,function(n){if(o.pk_component==n.fk_component){var t=!0;angular.forEach(e.selectedCombinationsR2,function(e){n.pk_version!=e.pk_version&&(t=!1)}),t&&(n.name=n.version+" - "+o.name,e.availableVersionsR2.push(n))}})},e.moveSelectedVersionsR2=function(o){if("selected"==o&&(angular.forEach(e.selectedVersions,function(o){e.selectedCombinationsR2.push(o)}),e.generateAvailableVersionsR2()),"available"==o){var n=[],t=jQuery("#selectedCombinationsR2Selector");angular.forEach(e.selectedVersions,function(e){n[e.pk_version]=e});var r=angular.copy(e.selectedCombinationsR2);e.selectedCombinationsR2=[],angular.forEach(r,function(o){void 0==n[o.pk_version]&&e.selectedCombinationsR2.push(o)}),e.generateAvailableVersionsR2()}}});